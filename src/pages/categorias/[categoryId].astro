---
// Internal API imports
import { getNews } from '@/lib/api/news';
import type { NewsArticle } from '@/lib/api/news';

// Astro components (layouts)
import Layout from '@/layouts/Layout.astro';

// Astro components (UI)
import NewsCard from '@/components/ui/NewsCard.astro';

// Get category ID from route params
const { categoryId } = Astro.params as { categoryId: string };
if (!categoryId) throw Astro.redirect('/404');

// Fetch news articles for this category
const { products }: { products: NewsArticle[] } = await getNews({ categoryId });

// Configuración de Caché
Astro.response.headers.set('Cache-Control', 'public, s-maxage=31536000, must-revalidate');
Astro.response.headers.set('Vercel-CDN-Cache-Control', 'public, s-maxage=31536000, must-revalidate');
Astro.response.headers.set('Cache-Tag', `news, category-${categoryId}`);
---

<Layout title={categoryId} booleanLayout={true}>
	<div class="animate-fadeIn">
		<!-- Header de categoría con animación -->
		<div
			class="relative bg-gradient-to-r from-green-600 to-green-700 py-16 dark:from-green-800 dark:to-blue-900"
		>
			<div
				class="bg-grid-white/10 absolute inset-0 bg-fixed mix-blend-soft-light dark:mix-blend-overlay"
			>
			</div>
			<div class="container-main relative">
				<h2
					class="text-center text-4xl font-bold tracking-tight text-white md:text-5xl dark:text-gray-100"
				>
					{categoryId.replace(/_/g, ' ').charAt(0).toUpperCase() + categoryId.slice(1)}
				</h2>
				<p class="mt-4 text-center text-lg text-green-100 dark:text-gray-300">
					Explora las últimas noticias y actualizaciones
				</p>
			</div>
		</div>

		<!-- Grid de noticias con animación -->
		<section class="container-main py-12">
			<div class="grid items-stretch gap-8 sm:grid-cols-2 lg:grid-cols-3">
				{
					products.map((product: any, index: number) => (
						<div class="group h-full transform transition-all duration-300 hover:-translate-y-0.5 hover:shadow-xl">
							<NewsCard product={product} truncateWords={30} className="h-full" />
						</div>
					))
				}
			</div>
		</section>
	</div>
</Layout>
