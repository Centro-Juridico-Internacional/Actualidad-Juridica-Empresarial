---
// Capa de Servicios y Tipos de Datos
import { getNews } from '@/lib/api/news';
import type { NewsArticle } from '@/lib/api/news';

// Componentes de Layout
import Layout from '@/layouts/Layout.astro';

// Componentes de Interfaz de Usuario (UI)
import NewsCard from '@/components/ui/NewsCard.astro';
import Breadcrumb from '@/components/ui/Breadcrumb.astro';
import PageHero from '@/components/ui/PageHero.astro';

// Captura del ID de categoría desde los parámetros de la ruta dinámica
const { categoryId } = Astro.params as { categoryId: string };
if (!categoryId) throw Astro.redirect('/404');

// Normalización para asegurar coincidencias sin distinción de mayúsculas/minúsculas
const normalizedCategoryId = categoryId.toLowerCase().trim();

// Obtención de artículos asociados a la categoría solicitada
const { products }: { products: NewsArticle[] } = await getNews({
	categoryId: normalizedCategoryId
});

// ISR maneja el cache automáticamente en modo hybrid
---

<Layout title={categoryId} booleanLayout={true} breadcrumbTitle={categoryId.replace(/_/g, ' ')}>
	<PageHero
		title={categoryId.replace(/_/g, ' ')}
		subtitle="Explora las últimas noticias y actualizaciones"
		className="capitalize"
	/>

	<!-- Grid de noticias con animación -->
	<section class="container-main py-12">
		<Breadcrumb title={categoryId.replace(/_/g, ' ')} className="mb-8" />
		<div class="grid items-stretch gap-8 sm:grid-cols-2 lg:grid-cols-3">
			{
				products.map((product: any, index: number) => (
					<div class="group h-full transform transition-all duration-300 hover:-translate-y-0.5 hover:shadow-xl">
						<NewsCard product={product} truncateWords={30} className="h-full" />
					</div>
				))
			}
		</div>
	</section>
</Layout>
