---
// @ts-ignore
import Layout from "@/layouts/Layout.astro"; 
// @ts-ignore
import { getProducts } from "lib/get-products";

const { categoryId } = Astro.params; 
if (!categoryId) throw Astro.redirect("/404");

const { products } = await getProducts({ categoryId });

---

<Layout title={categoryId} booleanLayout={true}>
  <section class="mx-auto max-w-6xl px-4 py-8">
    <h1 class="mb-6 text-3xl font-bold capitalize">Categoría: {categoryId}</h1>
    <p class="mb-10 text-gray-600">
      Explora nuestra colección de {categoryId} para hombres y mujeres.
    </p>

    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {products.map((product: any) => {
        const description = product.description?.[0]?.children?.[0]?.text ?? "";
        return (
          <article class="rounded-2xl border border-gray-200 bg-white p-4 shadow-md transition hover:shadow-lg">
            <img src={product.image} alt={product.name} class="mb-4 h-48 w-full object-cover rounded-md" />
            <h2 class="mb-2 text-xl font-semibold">{product.name}</h2>
            <p class="mb-4 text-sm text-gray-500 line-clamp-3">{description}</p>

            <div class="flex items-center justify-between">
              <span class="text-lg font-bold text-green-600">
                ${product.price}
              </span>
              <span class="text-xs text-gray-400">Stock: {product.stock}</span>
            </div>

            <a 
              href={`/product/${product.slug}`} 
              class="mt-4 inline-block w-full rounded-xl bg-green-600 px-4 py-2 text-center text-white font-medium hover:bg-green-700 transition"
            >
              Ver producto
            </a>
          </article>
        );
      })}
    </div>
  </section>
</Layout>
