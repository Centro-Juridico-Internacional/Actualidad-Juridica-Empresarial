---
// Capa de Servicios e Integración con API de Revistas
import { getMagazineBySlug } from '@/lib/api/magazines';

// Componentes de Layout y UI
import Layout from '@/layouts/Layout.astro';
import Breadcrumb from '@/components/ui/Breadcrumb.astro';
import PageHero from '@/components/ui/PageHero.astro';

// Componentes de Funcionalidad (Visualizador de PDF)
import Magazine from '@/components/features/magazines/Magazine';

// Captura del ID de la revista desde los parámetros de la ruta dinâmica
const { magazineId } = Astro.params as { magazineId: string };
if (!magazineId) throw Astro.redirect('/404');

// Obtención de la edición digital específica mediante su slug
const magazine = await getMagazineBySlug(magazineId);

if (!magazine || !magazine.pdf) {
	throw Astro.redirect('/404');
}
---

<Layout title={magazine.title} booleanLayout={true}>
	<div class="animate-fadeIn min-h-screen">
		<PageHero title={magazine.title} />

		<!-- Información de la revista -->
		<section class="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
			<Breadcrumb title={magazine.title} className="mb-8" />
		</section>

		<!-- Visualizador de Revista (Procesamiento y Renderizado 3D) -->
		<section class="w-full bg-white">
			<Magazine client:only="react" pdfUrl={magazine.pdf} />
			<!-- Navegación a ediciones anteriores -->
			<section class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
				<a
					href="/revistas"
					class="bg-primary-600 hover:bg-primary-700 inline-flex items-center gap-2 rounded-lg px-6 py-2.5 font-medium text-white transition-colors"
				>
					<svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="2"
							d="M15 19l-7-7 7-7"></path>
					</svg>
					Volver a Revistas
				</a>
			</section>
		</section>
	</div>
</Layout>
