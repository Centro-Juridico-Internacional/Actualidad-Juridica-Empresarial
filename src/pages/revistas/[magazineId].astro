---
// Capa de Servicios e Integración con API de Revistas
import { getMagazineBySlug } from '@/lib/api/magazines';

// Componentes de Layout y UI
import Layout from '@/layouts/Layout.astro';
import Breadcrumb from '@/components/ui/Breadcrumb.astro';

// Componentes de Funcionalidad (Visualizador de PDF)
import Magazine from '@/components/features/magazines/Magazine';

// Captura del ID de la revista desde los parámetros de la ruta dinâmica
const { magazineId } = Astro.params as { magazineId: string };
if (!magazineId) throw Astro.redirect('/404');

// Obtención de la edición digital específica mediante su slug
const magazine = await getMagazineBySlug(magazineId);

if (!magazine || !magazine.pdf) {
	throw Astro.redirect('/404');
}
---

<Layout title={magazine.title} booleanLayout={true}>
	<div class="animate-fadeIn min-h-screen">
		<!-- Sección Hero de Edición Digital -->
		<section
			class="relative flex h-[25vh] min-h-[220px] w-full items-center justify-center overflow-hidden bg-green-900"
		>
			<div class="absolute inset-0 opacity-20">
				<!-- Pattern de fondo -->
				<svg
					class="h-full w-full"
					width="100%"
					height="100%"
					viewBox="0 0 800 800"
					xmlns="http://www.w3.org/2000/svg"
				>
					<defs>
						<pattern
							id="dotPattern"
							x="0"
							y="0"
							width="20"
							height="20"
							patternUnits="userSpaceOnUse"
						>
							<circle cx="2" cy="2" r="1" fill="white"></circle>
						</pattern>
					</defs>
					<rect width="800" height="800" fill="url(#dotPattern)"></rect>
				</svg>
			</div>
			<div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
				<h1 class="mb-4 text-4xl font-bold text-white md:text-5xl lg:text-6xl">
					{magazine.title}
				</h1>
			</div>
		</section>

		<!-- Información de la revista -->
		<section class="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
			<Breadcrumb title={magazine.title} className="mb-8" />
		</section>

		<!-- Visualizador de Revista (Procesamiento y Renderizado 3D) -->
		<section class="w-full bg-white">
			<Magazine client:only="react" pdfUrl={magazine.pdf} />
			<!-- Navegación a ediciones anteriores -->
			<section class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
				<a
					href="/revistas"
					class="inline-flex items-center gap-2 rounded-lg bg-green-600 px-6 py-2.5 font-medium text-white transition-colors hover:bg-green-700"
				>
					<svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="2"
							d="M15 19l-7-7 7-7"></path>
					</svg>
					Volver a Revistas
				</a>
			</section>
		</section>
	</div>
</Layout>
