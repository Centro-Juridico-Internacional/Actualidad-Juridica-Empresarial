---
// filepath: c:\Users\USUARIO PC\Desktop\ACTUALIDAD\frontend\src\pages\noticia\[newsId].astro
import Layout from '@/layouts/Layout.astro';
import { getNews } from '@/lib/get-news';
import { BlocksRenderer } from '@strapi/blocks-react-renderer';
import YouTubeLite from '@/components/home/global/YouTubeLite';
import LatestNews from '@/components/home/LatestNews.astro';

const { newsId } = Astro.params;
if (!newsId) throw Astro.redirect('/404');

// Recupera todas las noticias
const { products } = await getNews({ categoryId: '' });

// Busca la noticia específica por el slug
const product = products.find((item: any) => item.slug === newsId);
if (!product) throw Astro.redirect('/404');

// Genera el slug del autor
const autorSlug = product.autorName
	? `/autores/${product.autorName.toLowerCase().replace(/\s+/g, '_')}`
	: '#';
---

<Layout title={product.titulo} booleanLayout={true}>
	<section class="mx-auto max-w-6xl px-4 py-8">
		<h1 class="mb-4 text-4xl font-extrabold text-green-600">{product.titulo}</h1>
		<div class="mb-4 flex items-center gap-4 text-sm text-gray-600">
			<span>{product.dia} &bull; {product.hora}</span>
			<div class="flex items-center gap-2">
				<a href={autorSlug} title={product.autorName}>
					<img
						src={product.autorAvatar}
						alt="Autor"
						class="h-8 w-8 rounded-full"
						loading="lazy"
						decoding="async"
					/>
				</a>
				<a href={autorSlug} class="text-sm text-gray-600 hover:text-green-600 hover:underline">
					{product.autorName}
				</a>
			</div>
			<div>
				<a
					href={`/categorias/${product.categorias[0]}`}
					class="inline-block rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-700 transition hover:bg-green-200"
				>
					{product.categorias[0].charAt(0).toUpperCase() + product.categorias[0].slice(1)}
				</a>
			</div>
		</div>
		<div class="mb-8 flex items-center justify-center">
			<img
				src={product.image}
				alt={`${product.titulo} imagen`}
				class="w-[35vw] rounded-lg shadow-lg"
				loading="eager"
				decoding="async"
				fetchpriority="high"
			/>
		</div>
		<div class="mb-8 text-justify text-gray-700">
			<BlocksRenderer content={product.contenido} />
		</div>
		{
			product.UrlYoutube && (
				<div class="mt-8">
					<YouTubeLite videoid={product.UrlYoutube} title={product.titulo} client:visible />
				</div>
			)
		}
	</section>

	<section class="mt-12 w-[20vw]">
		<h2 class="mb-4 text-2xl font-bold text-gray-800">Últimas noticias</h2>
		<LatestNews layout="vertical" currentSlug={newsId} />
	</section>
</Layout>
