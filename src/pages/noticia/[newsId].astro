---
//@ts-expect-error
import Layout from '@/layouts/Layout.astro';
//@ts-expect-error
import { getNews } from '@/lib/get-news';
import { BlocksRenderer } from '@strapi/blocks-react-renderer';
//@ts-expect-error
import YouTubeLite from '@/components/home/global/YouTubeLite';

const { newsId } = Astro.params;
if (!newsId) throw Astro.redirect('/404');

// Recupera todas las noticias
const { products } = await getNews({ categoryId: '' });

// Busca la noticia especÃ­fica por el slug
const product = products.find((item: any) => item.slug === newsId);
if (!product) throw Astro.redirect('/404');

// Genera el slug del autor
const autorSlug = product.autorName
	? `/autores/${product.autorName.toLowerCase().replace(/\s+/g, '_')}`
	: '#';
---

<Layout title={product.titulo} booleanLayout={true}>
	<section class="mx-auto max-w-6xl px-4 py-8">
		<h1 class="mb-8 text-center text-4xl font-extrabold tracking-tight text-gray-800">
			{product.titulo}
		</h1>
		<div class="flex flex-col gap-8 md:flex-row">
			<div class="flex-1">
				<img
					src={product.image}
					alt={`${product.titulo} imagen`}
					class="w-full rounded-lg shadow-lg"
				/>
				{
					product.UrlYoutube && (
						<div class="mt-8">
							<YouTubeLite videoid={product.UrlYoutube} title={product.titulo} client:load />
						</div>
					)
				}
			</div>
			<div class="flex-1">
				<div class="mb-4 text-justify text-gray-700">
					<BlocksRenderer content={product.contenido} />
				</div>
				<div class="mb-4 flex flex-wrap items-center gap-2">
					<span
						class="inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-center text-xs font-semibold text-blue-800"
					>
						{product.dia} &bull; {product.hora}
					</span>
					{
						product.categorias.map((item: any) => (
							<a
								href={`/categorias/${item}`}
								class="inline-block rounded-full bg-green-100 px-2 py-0.5 text-center text-xs font-medium text-green-700 transition hover:bg-green-200"
							>
								{item}
							</a>
						))
					}
				</div>
				<div class="mt-auto flex items-center border-t border-gray-100 pt-4">
					<a href={autorSlug} title={product.autorName}>
						<img src={product.autorAvatar} alt="Autor" class="mr-3 h-8 w-8 rounded-full" />
					</a>
					<a href={autorSlug} class="text-sm text-gray-600 hover:text-green-600 hover:underline">
						{product.autorName}
					</a>
				</div>
			</div>
		</div>
	</section>
</Layout>
