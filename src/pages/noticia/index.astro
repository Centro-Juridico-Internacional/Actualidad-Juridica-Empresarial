---
// Pages: /noticia/index.astro

// Internal API imports
import { getNews } from '@/lib/api/news';

// Astro components (layouts)
import Layout from '@/layouts/Layout.astro';

// Astro components (UI)
import NewsCard from '@/components/ui/NewsCard.astro';
import Breadcrumb from '@/components/ui/Breadcrumb.astro';

// Categories configuration (matching Header.astro)
const CATEGORIES = [
	{ name: 'Laboral', slug: 'laboral' },
	{ name: 'Comercial', slug: 'comercial' },
	{ name: 'Civil', slug: 'civil' },
	{ name: 'Administrativo', slug: 'administrativo' },
	{ name: 'Societario', slug: 'societario' },
	{ name: 'SG-SST', slug: 'sg-sst' },
	{ name: 'Familia', slug: 'familia' }
];

// Fetch 6 latest news for each category in parallel
const categoriesData = await Promise.all(
	CATEGORIES.map(async (category) => {
		const { products } = await getNews({ categoryId: category.slug });
		return {
			...category,
			news: products.slice(0, 6)
		};
	})
);
---

<Layout title="Noticias Jurídicas" booleanLayout={true} breadcrumbTitle="Noticias">
	<!-- Hero Section -->
	<section
		class="relative mb-12 flex h-[25vh] min-h-[220px] w-full items-center justify-center overflow-hidden bg-green-900"
	>
		<div class="absolute inset-0 opacity-20">
			<svg
				class="h-full w-full"
				width="100%"
				height="100%"
				viewBox="0 0 800 800"
				xmlns="http://www.w3.org/2000/svg"
			>
				<defs>
					<pattern id="dotPattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
						<circle cx="2" cy="2" r="1" fill="white"></circle>
					</pattern>
				</defs>
				<rect width="800" height="800" fill="url(#dotPattern)"></rect>
			</svg>
		</div>
		<div class="container-main relative z-10 px-4 text-center">
			<h1 class="mb-4 text-4xl font-bold text-white md:text-5xl lg:text-6xl">
				Actualidad Jurídica
			</h1>
			<p class="mx-auto max-w-2xl text-lg text-green-100">
				Mantente informado con las últimas novedades de todas nuestras áreas de práctica
			</p>
		</div>
	</section>

	<div class="container-main space-y-20 pb-16">
		<Breadcrumb title="Noticias" className="mb-0" />
		{
			categoriesData.map(
				(category) =>
					category.news.length > 0 && (
						<section>
							<div class="mb-8 flex items-center justify-between border-b border-gray-100 pb-4">
								<h2 class="text-3xl font-bold text-gray-900">{category.name}</h2>
								<a
									href={`/categorias/${category.slug}`}
									class="group flex items-center text-sm font-semibold text-green-700 transition-colors hover:text-green-800"
								>
									Ver todas
									<span class="ml-1 transition-transform duration-300 group-hover:translate-x-1">
										→
									</span>
								</a>
							</div>

							<div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
								{category.news.map((product) => (
									<div class="group h-full transform transition-all duration-300 hover:-translate-y-0.5 hover:shadow-xl">
										<NewsCard product={product} truncateWords={20} className="h-full" />
									</div>
								))}
							</div>
						</section>
					)
			)
		}

		{/* State where no news found at all */}
		{
			categoriesData.every((cat) => cat.news.length === 0) && (
				<div class="py-20 text-center">
					<p class="text-xl text-gray-500">No hay noticias disponibles en este momento.</p>
				</div>
			)
		}
	</div>
</Layout>
