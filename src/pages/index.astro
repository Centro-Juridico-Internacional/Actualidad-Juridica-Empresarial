---
// Componentes de Layout
import Layout from '@/layouts/Layout.astro';

// Organismos de la Página de Inicio (Secciones)
import ContainerInterviewMagazine from '@/components/sections/home/ContainerInterviewMagazine.astro';
import InformationOfInterest from '@/components/sections/home/InformationOfInterest.astro';
import MoreNews from '@/components/sections/home/MoreNews.astro';
import News from '@/components/sections/home/News.astro';
import Podcast from '@/components/sections/home/Podcast.astro';
import Magazine from '@/components/features/magazines/Magazine';

// Capa de Servicios y API (Acceso a Datos)
import { getNews } from '@/lib/api/news';
import { getPautas } from '@/lib/api/pautas';
import { getInterviewsUrl } from '@/lib/api/interviews';
import { getCapsulasUrl } from '@/lib/api/capsulas';
import { getMagazines } from '@/lib/api/magazines';

import UpcomingEvents from '@/components/sections/home/UpcomingEvents.astro';
import Recognitions from '@/components/sections/home/Recognitions.astro';
import SocialMedia from '@/components/sections/home/SocialMedia.astro';
import AlliesCarousel from '@/components/sections/home/AlliesCarousel.astro';

// Obtención centralizada de datos para optimizar el rendimiento y evitar "Waterfalls"
// Se ejecutan todas las promesas en paralelo para reducir la latencia total de carga.
const [newsData, pautas, interviews, capsulas, magazines] = await Promise.all([
	getNews({ categoryId: '' }),
	getPautas(),
	getInterviewsUrl(),
	getCapsulasUrl(),
	getMagazines()
]);

const { products } = newsData;

// ISR maneja el cache automáticamente en modo hybrid
---

<Layout title="Inicio" booleanLayout={false}>
	<News products={products} />
	<InformationOfInterest products={products} />
	<MoreNews products={products} />
	<ContainerInterviewMagazine pautas={pautas} interviews={interviews} />
	<Podcast capsulas={capsulas} />
	<UpcomingEvents />
	<Recognitions />
	{
		magazines[0]?.pdf && (
			<Magazine
				client:only="react"
				pdfUrl={`/api/pdf?url=${encodeURIComponent(magazines[0].pdf)}`}
			/>
		)
	}

	<AlliesCarousel />
	<SocialMedia />
</Layout>
