---
// Astro components (layouts)
import Layout from '@/layouts/Layout.astro';

// Astro components (sections)
import ContainerInterviewMagazine from '@/components/sections/home/ContainerInterviewMagazine.astro';
import InformationOfInterest from '@/components/sections/home/InformationOfInterest.astro';
import MoreNews from '@/components/sections/home/MoreNews.astro';
import News from '@/components/sections/home/News.astro';
import Podcast from '@/components/sections/home/Podcast.astro';
import Magazine from '@/components/features/magazines/Magazine';

// Internal API imports
import { getNews } from '@/lib/api/news';
import { getPautas } from '@/lib/api/pautas';
import { getInterviewsUrl } from '@/lib/api/interviews';
import { getCapsulasUrl } from '@/lib/api/capsulas';
import { getMagazines } from '@/lib/api/magazines';

// Import responsive styles for magazine only for this page
import '@/styles/revista-responsive.css';
import UpcomingEvents from '@/components/sections/home/UpcomingEvents.astro';
import Recognitions from '@/components/sections/home/Recognitions.astro';
import SocialMedia from '@/components/sections/home/SocialMedia.astro';
import AlliesCarousel from '@/components/sections/home/AlliesCarousel.astro';

// Fetch all data once at page level to avoid redundant API calls
// Fetch all data in parallel to reduce load time
const [newsData, pautas, interviews, capsulas, magazines] = await Promise.all([
	getNews({ categoryId: '' }),
	getPautas(),
	getInterviewsUrl(),
	getCapsulasUrl(),
	getMagazines()
]);

const { products } = newsData;
console.log(magazines);

// ISR maneja el cache autom√°ticamente en modo hybrid
---

<Layout title="Inicio" booleanLayout={false}>
	<News products={products} />
	<InformationOfInterest products={products} />
	<MoreNews products={products} />
	<ContainerInterviewMagazine pautas={pautas} interviews={interviews} />
	<Podcast capsulas={capsulas} />
	<UpcomingEvents />
	<Recognitions />
	<!-- {magazines[0]?.pdf && <Magazine client:only="react" pdfUrl={magazines[0].pdf} />} -->
	{
		magazines[0]?.pdf && (
			<Magazine
				client:only="react"
				pdfUrl={`/api/pdf?url=${encodeURIComponent(magazines[0].pdf)}`}
			/>
		)
	}

	<AlliesCarousel />
	<SocialMedia />
</Layout>
