---
// Astro components (layouts)
import Layout from '@/layouts/Layout.astro';

// Astro components (sections)
import ContainerInterviewMagazine from '@/components/sections/home/ContainerInterviewMagazine.astro';
import InformationOfInterest from '@/components/sections/home/InformationOfInterest.astro';
import MoreNews from '@/components/sections/home/MoreNews.astro';
import News from '@/components/sections/home/News.astro';
import Podcast from '@/components/sections/home/Podcast.astro';
import Revista from '@/components/features/revista/Revista';

// Internal API imports
import { getNews } from '@/lib/api/news';
import type { NewsArticle } from '@/lib/api/news';
import { getPautas } from '@/lib/api/pautas';
import { getInterviewsUrl } from '@/lib/api/interviews';

// Importar estilos responsive de la revista SOLO para esta página
import '@/styles/revista-responsive.css';
import UpcomingEvents from '@/components/sections/home/UpcomingEvents.astro';

// Fetch all data once at page level to avoid redundant API calls
const { products }: { products: NewsArticle[] } = await getNews({ categoryId: '' });
const pautas = await getPautas();
const interviews = await getInterviewsUrl();

// Configuración de Caché (ISR On-Demand)
// 1 año de caché en Edge (s-maxage). Se invalidará vía Webhook usando los Tags.
Astro.response.headers.set('Cache-Control', 'public, s-maxage=31536000, must-revalidate');
// Tags para invalidación granular: 'home' (general), 'news' (si cambia una noticia), 'banner', 'author'
Astro.response.headers.set('Vercel-CDN-Cache-Control', 'public, s-maxage=31536000, must-revalidate');
Astro.response.headers.set('Cache-Tag', 'home, news, banner, author');
---

<Layout title="Inicio" booleanLayout={false}>
	<News products={products} />
	<InformationOfInterest products={products} />
	<MoreNews products={products} />
	<ContainerInterviewMagazine pautas={pautas} interviews={interviews} />
	<Podcast pautas={pautas} interviews={interviews} />
	<UpcomingEvents />
	<Revista
		client:only="react"
		pdfUrl="/revistas/revista.pdf"
		height={700}
		className="revista-flipbook"
	/>
</Layout>
