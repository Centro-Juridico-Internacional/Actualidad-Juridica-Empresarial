---
// Importaciones Externas

// Utilidades Internas
import { Image } from 'astro:assets';
import { truncateBlocks } from '@/utils/truncateBlocks';
import type { NewsArticle } from '@/lib/api/news';

// Componentes React
import YouTubeLite from '@/components/features/media/YouTubeLite';

// Interfaz de Propiedades
interface Props {
	product: NewsArticle;
	truncateWords?: number;
	className?: string;
}

// Desestructuración de props con valores por defecto
const { product, truncateWords = 30, className = '' }: Props = Astro.props;

// Generar slug del autor para el enlace
const authorSlug: string = product.authorName
	? `/autores/${product.authorName.toLowerCase().replace(/\s+/g, '_')}`
	: '#';

// Truncar bloques de contenido al conteo de palabras especificado
const { text: contentText, truncated } = truncateBlocks(product.content, truncateWords);
---

<article class="group relative flex h-full flex-col overflow-hidden rounded-2xl bg-white shadow-md">
	<!-- Imagen con overlay gradual (altura consistente) -->
	<div class="relative aspect-[16/9] w-full overflow-hidden">
		<Image
			src={product.image || '/news-default.png'}
			alt={`${product.title} imagen`}
			width={800}
			height={450}
			class="h-full w-full object-cover transition-transform duration-700 ease-in-out"
			loading="lazy"
			decoding="async"
		/>
		<div
			class="pointer-events-none absolute inset-0 bg-gradient-to-t from-green-200/45 via-transparent to-transparent opacity-0 transition-opacity duration-[900ms] ease-[cubic-bezier(.22,1,.36,1)] group-hover:opacity-100 after:absolute after:inset-x-6 after:bottom-4 after:h-4 after:translate-y-6 after:transform-gpu after:rounded-full after:bg-black/20 after:opacity-0 after:blur-md after:transition-all after:delay-[150ms] after:duration-[900ms] after:ease-[cubic-bezier(.22,1,.36,1)] after:will-change-transform after:content-[''] group-hover:after:translate-y-0 group-hover:after:opacity-100"
		>
		</div>
	</div>

	<!-- Contenido -->
	<div class="flex min-h-0 flex-1 flex-col p-6">
		<!-- Categorías y Fecha -->
		<div class="mb-4 flex flex-wrap items-center gap-2">
			<span
				class="relative z-20 inline-flex items-center rounded-full bg-green-50 px-3 py-1 text-xs font-medium text-green-700"
			>
				{product.day} • {product.time}
			</span>
			{
				product.categories.map((item: any) => (
					<a
						href={`/categorias/${item.toLowerCase()}`}
						class="relative z-20 inline-block items-center rounded-full bg-gray-50 px-3 py-1 text-xs font-medium text-gray-600 transition-colors first-letter:uppercase hover:bg-green-50 hover:text-green-700"
					>
						{item}
					</a>
				))
			}
		</div>

		<!-- Título -->
		<h3
			class="mb-2 text-xl leading-tight font-bold text-gray-900 decoration-green-500 decoration-2 group-hover:underline"
		>
			<a
				href={`/noticia/${product.slug}`}
				class="after:absolute after:inset-0 after:z-10"
				aria-label={product.title}
			>
				{product.title}
			</a>
		</h3>

		<!-- Extracto con clamp para no romper alturas -->
		<div class="mb-4 line-clamp-3 text-sm leading-relaxed text-gray-600 lg:line-clamp-4">
			{contentText}
		</div>

		<!-- Video de YouTube si existe (altura consistente) -->
		{
			product.youtubeUrl && (
				<div
					class="relative z-20 mb-4 aspect-video overflow-hidden rounded-xl shadow-sm"
					data-videoid={product.youtubeUrl}
				>
					<YouTubeLite
						videoid={product.youtubeUrl}
						title={product.title}
						client:visible
						transition:persist
					/>
				</div>
			)
		}

		<!-- Empuja autor al fondo para que la card llene la fila -->
		<div class="mt-auto flex items-center gap-3 border-t border-gray-100 pt-4">
			<a
				href={authorSlug}
				title={product.authorName}
				class="relative z-20 overflow-hidden rounded-full ring-2 ring-gray-100 transition-all hover:ring-green-200"
			>
				<Image
					src={product.authorAvatar || '/avatar-default.png'}
					alt={product.authorName}
					width={40}
					height={40}
					class="h-10 w-10 object-fill"
					loading="lazy"
					decoding="async"
				/>
			</a>
			<div class="relative z-20 flex flex-col">
				<a href={authorSlug} class="text-sm font-medium text-gray-900 hover:text-green-600">
					{product.authorName}
				</a>
				<span class="text-xs text-gray-500">{product.authorRole ?? 'Autor'}</span>
			</div>
		</div>
	</div>
</article>
