---
// Importaciones de API Interna
import { getLatestNews } from '@/lib/api/news';
import type { NewsArticle } from '@/lib/api/news';

// Interfaz de Propiedades
interface Props {
	currentSlug?: string | null;
	layout?: 'vertical' | 'horizontal';
	categorySlugs?: string[];
	limit?: number;
}

// Desestructuración de props con valores por defecto
const { currentSlug = null, layout = 'vertical', categorySlugs, limit = 4 }: Props = Astro.props;

// Obtener últimas noticias (optimizado) excluyendo la actual, y filtrando por categoría opcionalmente
const latestNews: NewsArticle[] = await getLatestNews(
	limit,
	currentSlug ?? undefined,
	categorySlugs
);
---

<div
	class={`grid gap-6 ${layout === 'vertical' ? 'grid-cols-1' : 'md:grid-cols-2 lg:grid-cols-3'}`}
>
	{
		latestNews.map((news: any) => (
			<div class="group hover:border-secondary-200 relative flex w-full items-start gap-3 border-b border-gray-100 pb-4 transition-colors sm:gap-4 sm:pb-6">
				{/* Imagen responsive con aspect ratio fijo */}
				<div class="relative h-20 w-20 shrink-0 overflow-hidden rounded-xl sm:h-24 sm:w-24">
					<img
						src={news.image}
						alt={news.title}
						class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
						loading="lazy"
						decoding="async"
					/>
					<div class="absolute inset-0 bg-linear-to-t from-black/30 to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100" />
				</div>

				{/* Contenido con truncamiento inteligente */}
				<div class="flex min-w-0 flex-1 flex-col gap-1">
					{/* Categoría */}
					<a
						href={`/categorias/${news.categories[0]?.toLowerCase()}`}
						class="text-secondary-600 hover:text-secondary-700 inline-block w-fit text-xs font-medium transition-colors first-letter:uppercase"
					>
						{news.categories[0]?.trim()}
					</a>

					{/* Título con truncamiento a 2 líneas */}
					<h3 class="decoration-secondary-500 line-clamp-2 text-sm leading-tight font-semibold text-gray-900 decoration-2 group-hover:underline sm:text-base">
						<a href={`/noticia/${news.slug}`} class="hover:text-secondary-700">
							{news.title}
						</a>
					</h3>

					{/* Fecha */}
					<time class="mt-1 text-xs text-gray-500">{news.day}</time>
				</div>
			</div>
		))
	}
</div>
